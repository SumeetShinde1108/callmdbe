CallFairy Django Project Documentation

1) Overview
- Name: callfairy
- Framework: Django 5.2.6 with Django REST Framework, SimpleJWT, Channels, AllAuth, django-otp
- Purpose: Voice AI platform backend with API, auth, and real-time capabilities
- Entry points:
  - manage: manage.py (DJANGO_SETTINGS_MODULE=callfairy.settings)
  - WSGI: callfairy/wsgi.py
  - ASGI: callfairy/asgi.py (used by daphne via docker-compose)

2) Tech Stack
- Python 3.12 (Dockerfile)
- Django, DRF, SimpleJWT, django-filter, drf-yasg (Swagger/Redoc)
- Channels + Redis, Daphne ASGI server
- Auth: django-allauth (Google, Microsoft), custom user model (email login), django-otp
- DB: SQLite (dev) via settings; docker-compose defines Postgres service
- Payments: stripe (keys in .env)

3) Project Structure (selected)
- Root
  - manage.py
  - requirements.txt
  - docker-compose.yml, Dockerfile
  - db.sqlite3
  - .env (loaded by settings via django-environ)
  - media/ (runtime)
  - callfairy/
    - settings.py, urls.py, asgi.py, wsgi.py
    - templates/ (empty)
    - static/ (empty)
    - apps/
      - accounts/ (active API)
      - products/, solutions/, subscriptions/, contact/, usecases/, voiceai/, support/, chat/, calculator/ (placeholders)

4) Settings Summary (callfairy/settings.py)
- INSTALLED_APPS (core): django.contrib.*, django.contrib.sites
- Third-party: rest_framework, rest_framework_simplejwt, django_filters, drf_yasg, corsheaders, channels, allauth (+providers), django_otp (+totp)
- Local apps: callfairy.apps.[accounts|products|solutions|subscriptions|contact|usecases|voiceai|support|chat|calculator]
- Templates: DIRS=[BASE_DIR/callfairy/templates], APP_DIRS=True
- Static: STATIC_URL=/static/, STATIC_ROOT=BASE_DIR/static, STATICFILES_DIRS=[BASE_DIR/callfairy/static]
- Media: MEDIA_URL=/media/, MEDIA_ROOT=BASE_DIR/media
- Database: SQLite (NAME=BASE_DIR/db.sqlite3)
- Channels: Redis (CHANNEL_LAYERS default hosts=[REDIS_URL from env])
- Auth: AUTH_USER_MODEL=accounts.User
- DRF: JWT + Session auth, IsAuthenticated default, django-filter, page size=10
- JWT: Access=60m, Refresh=1d
- CORS: http://localhost:3000, http://127.0.0.1:3000
- AllAuth: email login; mandatory email verification; SITE_ID=1
- Email: EMAIL_* from env
- OAuth: Google/Microsoft client IDs/secrets from env
- Stripe: keys from env
- DEBUG/ALLOWED_HOSTS/SECRET_KEY loaded from .env

5) URLs (callfairy/urls.py)
- Admin: /admin/
- API Docs: /swagger<format>/, /swagger/, /redoc/
- API v1: /api/v1/
  - Included patterns:
    - auth/: callfairy.apps.accounts.urls
    - Other app URLs are commented out placeholders for future implementation
- AllAuth: /accounts/
- Media/Static: served in DEBUG via django.conf.urls.static

6) Accounts App (callfairy/apps/accounts)
- Models (models.py)
  - User(AbstractBaseUser, PermissionsMixin)
    - Fields: email(unique), name, is_active, is_staff, date_joined(auto_now_add), company, job_title, phone
    - USERNAME_FIELD=email, REQUIRED_FIELDS=[name]
    - Manager: CustomUserManager(create_user, create_superuser)
- Serializers (serializers.py)
  - RegisterSerializer: email, password(+validation), password2, name; creates user via manager
  - LoginSerializer: email, password; authenticate() returns user
  - UserSerializer: id, email, name, company, job_title, phone, date_joined
  - CustomTokenObtainPairSerializer: extends payload with user data
- Views (views.py)
  - RegisterView: POST register
  - LoginView: POST login returns {access, refresh}
  - MeView: GET authenticated user profile
- URLs (urls.py)
  - POST /api/v1/auth/register/ -> RegisterView
  - POST /api/v1/auth/login/ -> LoginView
  - POST /api/v1/auth/token/refresh/ -> SimpleJWT TokenRefreshView
  - GET  /api/v1/auth/me/ -> MeView (JWT/Session auth)

7) Other Apps (placeholders)
- Each of: products, solutions, subscriptions, contact, usecases, voiceai, support, chat, calculator
  - Present files: admin.py, apps.py, migrations/, models.py (empty placeholder), views.py (placeholder), tests.py
  - No urls.py currently included (API inclusion lines in project urls.py are commented)

8) API Authentication & Permissions
- Default DRF permission: IsAuthenticated
- Authentication classes: JWT (Bearer), Session
- Public endpoints: accounts.register, accounts.login, token refresh
- Private endpoints: accounts.me (requires auth)

9) Realtime (Channels)
- ASGI application configured; Redis channel layer required (REDIS_URL env)
- docker-compose provides redis:7 container on port 6379

10) CMS
- Not applicable. CMS has been removed from this project.

11) Environment Variables (.env)
- SECRET_KEY
- DEBUG=true|false
- ALLOWED_HOSTS=comma-separated list
- REDIS_URL=redis://redis:6379/0 (for docker) or other
- Email: EMAIL_BACKEND, EMAIL_HOST, EMAIL_PORT, EMAIL_USE_TLS, EMAIL_HOST_USER, EMAIL_HOST_PASSWORD
- OAuth: GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET, MICROSOFT_CLIENT_ID, MICROSOFT_CLIENT_SECRET
- Stripe: STRIPE_PUBLIC_KEY, STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET

12) Running Locally (without Docker)
- Create venv and install deps:
  python -m venv .venv
  source .venv/bin/activate
  pip install -r requirements.txt
- Create .env (see Environment Variables). For local development:
  DEBUG=true
  SECRET_KEY=dev-secret
  ALLOWED_HOSTS=localhost,127.0.0.1
  REDIS_URL=redis://127.0.0.1:6379/0
  EMAIL_BACKEND=django.core.mail.backends.console.EmailBackend
- Apply migrations and start server:
  python manage.py migrate
  python manage.py runserver
- API docs: http://127.0.0.1:8000/swagger/ and http://127.0.0.1:8000/redoc/

13) Running with Docker
- Requirements: Docker, Docker Compose
- Build & run:
  docker compose up --build
- Services:
  - web: daphne serving callfairy.asgi:application on 0.0.0.0:8000
  - db: postgres:15 (configure .env for DB if switching from SQLite)
  - redis:7 (needed for Channels)
- First-time setup (inside container):
  docker compose exec web python manage.py migrate
  docker compose exec web python manage.py createsuperuser

14) Switching to PostgreSQL
- Update DATABASES in settings.py or use DATABASE_URL pattern via django-environ (not currently configured)
- Provide Postgres env vars in .env and update settings accordingly

15) Static & Media
- collectstatic executed in Dockerfile at build time (RUN python manage.py collectstatic --noinput)
- STATIC_ROOT=BASE_DIR/static; MEDIA_ROOT=BASE_DIR/media
- In dev (DEBUG=True), static and media served via urlpatterns

16) Security & Production Notes
- Set DEBUG=False and configure ALLOWED_HOSTS
- Provide strong SECRET_KEY in .env
- Configure HTTPS, secure cookies, CORS origins
- Configure proper EMAIL backend for account verification
- Configure Redis (production-grade), DB (PostgreSQL), and a reverse proxy (e.g., Nginx)
- Review DRF default permission (IsAuthenticated) and open only the intended endpoints

17) Testing
- Each app has tests.py placeholders; expand with API and model tests

18) Versioning & Docs
- API base path: /api/v1/
- Interactive docs: Swagger (/swagger/) and ReDoc (/redoc/)

19) Contact & Licensing
- API schema metadata in urls.py indicates proprietary license and support email support@callfairy.com

End of docs.txt
